# -*- coding: utf-8 -*-

import download_info
import os,sys
from multiprocessing import Process, Queue, Pool
import json

old_url = {}
'''u'http://www.meituba.com/tag/changfa.html': ' \xe9\x95\xbf\xe5\x8f\x91\n', u'http://www.meituba.com/tag/zipai.html': ' \xe8\x87\xaa\xe6\x8b\x8d\n',u'http://www.meituba.com/tag/yongyi.html': ' \xe6\xb3\xb3\xe8\xa1\xa3\n','''
url = { u'http://www.meituba.com/tag/huola.html': ' \xe7\x81\xab\xe8\xbe\xa3\n', u'http://www.meituba.com/tag/rugou.html': ' \xe4\xb9\xb3\xe6\xb2\x9f\n', u'http://www.meituba.com/tag/neiyixiezhen.html': ' \xe6\x83\x85\xe8\xb6\xa3\xe5\x86\x85\xe8\xa1\xa3\n', u'http://www.meituba.com/tag/siwameitui.html': ' \xe4\xb8\x9d\xe8\xa2\x9c\n', u'http://www.meituba.com/tag/xiaoqingxin.html': ' \xe5\xb0\x8f\xe6\xb8\x85\xe6\x96\xb0\n', u'http://www.meituba.com/tag/zuqiubaobei.html': ' \xe8\xb6\xb3\xe7\x90\x83\xe5\xae\x9d\xe8\xb4\x9d\n', u'http://www.meituba.com/tag/sifangzhao.html': ' \xe7\xa7\x81\xe6\x88\xbf\xe7\x85\xa7\n', u'http://www.meituba.com/tag/dudoumeinv.html': ' \xe8\x82\x9a\xe5\x85\x9c\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/xinggannvhai.html': ' \xe6\x80\xa7\xe6\x84\x9f\xe5\xa5\xb3\xe5\xad\xa9\n', u'http://www.meituba.com/tag/xinggandiaodai.html': ' \xe6\x80\xa7\xe6\x84\x9f\xe5\x90\x8a\xe5\xb8\xa6\n', u'http://www.meituba.com/tag/jutun.html': ' \xe5\xb7\xa8\xe8\x87\x80\n', u'http://www.meituba.com/tag/taotu.html': ' \xe5\xa5\x97\xe5\x9b\xbe\n', u'http://www.meituba.com/tag/yushi.html': ' \xe6\xb5\xb4\xe5\xae\xa4\n', u'http://www.meituba.com/tag/yongchimeinv.html': ' \xe6\xb3\xb3\xe6\xb1\xa0\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/niuzaikumeinv.html': ' \xe7\x89\x9b\xe4\xbb\x94\xe8\xa3\xa4\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/danai.html': ' \xe5\xa4\xa7\xe5\xa5\xb6\n', u'http://www.meituba.com/tag/Loli.html': ' \xe8\x90\x9d\xe8\x8e\x89Loli\n', u'http://www.meituba.com/tag/shishang.html': ' \xe6\x97\xb6\xe5\xb0\x9a\n', u'http://www.meituba.com/tag/ribenmeinv.html': ' \xe6\x97\xa5\xe6\x9c\xac\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/weimeixiezhen.html': ' \xe5\x94\xaf\xe7\xbe\x8e\xe5\x86\x99\xe7\x9c\x9f\n', u'http://www.meituba.com/tag/rushen.html': ' \xe4\xb9\xb3\xe7\xa5\x9e\n', u'http://www.meituba.com/tag/xiaomeinv.html': ' \xe5\xb0\x8f\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/kuwa.html': ' \xe8\xa3\xa4\xe8\xa2\x9c\n', u'http://www.meituba.com/tag/dapigu.html': ' \xe5\xa4\xa7\xe5\xb1\x81\xe8\x82\xa1\n', u'http://www.meituba.com/tag/taiwanmeinv.html': ' \xe5\x8f\xb0\xe6\xb9\xbe\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/jvrumeinv.html': ' \xe5\xb7\xa8\xe4\xb9\xb3\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/keaimeinv.html': ' \xe5\x8f\xaf\xe7\x88\xb1\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/rousi.html': ' \xe8\x82\x89\xe4\xb8\x9d\n', u'http://www.meituba.com/tag/80houmeinv.html': ' \xe5\x90\x8e\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/mengmeizi.html': ' \xe8\x90\x8c\xe5\xa6\xb9\xe5\xad\x90\n', u'http://www.meituba.com/tag/zhifu.html': ' \xe5\x88\xb6\xe6\x9c\x8d\n', u'http://www.meituba.com/tag/juesemeinv.html': ' \xe7\xbb\x9d\xe8\x89\xb2\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/baisi.html': ' \xe7\x99\xbd\xe4\xb8\x9d\n', u'http://www.meituba.com/tag/baoru.html': ' \xe7\x88\x86\xe4\xb9\xb3\n', u'http://www.meituba.com/tag/jipinmeinv.html': ' \xe6\x9e\x81\xe5\x93\x81\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/wangwa.html': ' \xe7\xbd\x91\xe8\xa2\x9c\n', u'http://www.meituba.com/tag/xinggannvlang.html': ' \xe6\x80\xa7\xe6\x84\x9f\xe5\xa5\xb3\xe9\x83\x8e\n', u'http://www.meituba.com/tag/changqun.html': ' \xe9\x95\xbf\xe8\xa3\x99\n', u'http://www.meituba.com/tag/hunxuemeinv.html': ' \xe6\xb7\xb7\xe8\xa1\x80\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/suyan.html': ' \xe7\xb4\xa0\xe9\xa2\x9c\n', u'http://www.meituba.com/tag/meinvxiaohua.html': ' \xe7\xbe\x8e\xe5\xa5\xb3\xe6\xa0\xa1\xe8\x8a\xb1\n', u'http://www.meituba.com/tag/duanfa.html': ' \xe7\x9f\xad\xe5\x8f\x91\n', u'http://www.meituba.com/tag/tunvlang.html': ' \xe5\x85\x94\xe5\xa5\xb3\xe9\x83\x8e\n', u'http://www.meituba.com/tag/hanguomeinv.html': ' \xe9\x9f\xa9\xe5\x9b\xbd\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/yujie.html': ' \xe5\xbe\xa1\xe5\xa7\x90\n', u'http://www.meituba.com/tag/bijinimeinv.html': ' \xe6\xaf\x94\xe5\x9f\xba\xe5\xb0\xbc\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/yuru.html': ' \xe7\x8e\x89\xe4\xb9\xb3\n',  u'http://www.meituba.com/tag/sizu.html': ' \xe4\xb8\x9d\xe8\xb6\xb3\n', u'http://www.meituba.com/tag/suxiong.html': ' \xe9\x85\xa5\xe8\x83\xb8\n', u'http://www.meituba.com/tag/xueshengmei.html': ' \xe5\xad\xa6\xe7\x94\x9f\xe5\xa6\xb9\n', u'http://www.meituba.com/tag/feitun.html': ' \xe8\x82\xa5\xe8\x87\x80\n', u'http://www.meituba.com/tag/miaonvlang.html': ' \xe7\x8c\xab\xe5\xa5\xb3\xe9\x83\x8e\n', u'http://www.meituba.com/tag/shunv.html': ' \xe7\x86\x9f\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/fengyun.html': ' \xe9\xa3\x8e\xe9\x9f\xb5\n', u'http://www.meituba.com/tag/lengyan.html': ' \xe5\x86\xb7\xe8\x89\xb3\n', u'http://www.meituba.com/tag/hefumeinv.html': ' \xe5\x92\x8c\xe6\x9c\x8d\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/qizhimeinv.html': ' \xe6\xb0\x94\xe8\xb4\xa8\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/meinvzhubo.html': ' \xe7\xbe\x8e\xe5\xa5\xb3\xe4\xb8\xbb\xe6\x92\xad\n', u'http://www.meituba.com/tag/heisi.html': ' \xe9\xbb\x91\xe4\xb8\x9d\n',  u'http://www.meituba.com/tag/90houmeinv.html': ' \xe5\x90\x8e\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/fennen.html': ' \xe7\xb2\x89\xe5\xab\xa9\n', u'http://www.meituba.com/tag/neiyimeinv.html': ' \xe5\x86\x85\xe8\xa1\xa3\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/dachidu.html': ' \xe5\xa4\xa7\xe5\xb0\xba\xe5\xba\xa6\n', u'http://www.meituba.com/tag/fengsao.html': ' \xe9\xa3\x8e\xe9\xaa\x9a\n', u'http://www.meituba.com/tag/gaogenxie.html': ' \xe9\xab\x98\xe8\xb7\x9f\xe9\x9e\x8b\n', u'http://www.meituba.com/tag/guimi.html': ' \xe9\x97\xba\xe8\x9c\x9c\n', u'http://www.meituba.com/tag/xingganmm.html': ' \xe6\x80\xa7\xe6\x84\x9f\n', u'http://www.meituba.com/tag/yaoraomeinv.html': ' \xe5\xa6\x96\xe5\xa8\x86\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/nvpu.html': ' \xe5\xa5\xb3\xe4\xbb\x86\n', u'http://www.meituba.com/tag/fengman.html': ' \xe4\xb8\xb0\xe6\xbb\xa1\n', u'http://www.meituba.com/tag/nenmo.html': ' \xe5\xab\xa9\xe6\xa8\xa1\n', u'http://www.meituba.com/tag/qiaopi.html': ' \xe4\xbf\x8f\xe7\x9a\xae\n', u'http://www.meituba.com/tag/bailing.html': ' \xe7\x99\xbd\xe9\xa2\x86\n', u'http://www.meituba.com/tag/xingganshaonv.html': ' \xe6\x80\xa7\xe6\x84\x9f\xe5\xb0\x91\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/meinvzhaopian.html': ' \xe7\xbe\x8e\xe5\xa5\xb3\xe7\x85\xa7\xe7\x89\x87\n', u'http://www.meituba.com/tag/cxmeinv.html': ' \xe9\x95\xbf\xe9\x9d\xb4\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/dixiong.html': ' \xe4\xbd\x8e\xe8\x83\xb8\n', u'http://www.meituba.com/tag/yougoubihuo.html': ' \xe6\x9c\x89\xe6\xb2\x9f\xe5\xbf\x85\xe7\x81\xab\n', u'http://www.meituba.com/tag/wumei.html': ' \xe5\xa6\xa9\xe5\xaa\x9a\n', u'http://www.meituba.com/tag/gugan.html': ' \xe9\xaa\xa8\xe6\x84\x9f\n', u'http://www.meituba.com/tag/jiemeihua.html': ' \xe5\xa7\x90\xe5\xa6\xb9\xe8\x8a\xb1\n', u'http://www.meituba.com/tag/yangqimeinv.html': ' \xe6\xb0\xa7\xe6\xb0\x94\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/meiru.html': ' \xe7\xbe\x8e\xe4\xb9\xb3\n', u'http://www.meituba.com/tag/guomo.html': ' \xe5\x9b\xbd\xe6\xa8\xa1\n', u'http://www.meituba.com/tag/qingxinmeinv.html': ' \xe6\xb8\x85\xe6\x96\xb0\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/jvrumeixiong.html': ' \xe7\xbe\x8e\xe8\x83\xb8\n', u'http://www.meituba.com/tag/kunbangmeinv.html': ' \xe6\x8d\x86\xe7\xbb\x91\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/meitui.html': ' \xe7\xbe\x8e\xe8\x85\xbf\n', u'http://www.meituba.com/tag/xinggannvren.html': ' \xe6\x80\xa7\xe6\x84\x9f\xe5\xa5\xb3\xe4\xba\xba\n', u'http://www.meituba.com/tag/xgmm.html': ' \xe6\x80\xa7\xe6\x84\x9f\xe5\xa6\xb9\xe5\xa6\xb9\n', u'http://www.meituba.com/tag/baowenneiyi.html': ' \xe8\xb1\xb9\xe7\xba\xb9\xe5\x86\x85\xe8\xa1\xa3\n', u'http://www.meituba.com/tag/dingziku.html': ' \xe4\xb8\x81\xe5\xad\x97\xe8\xa3\xa4\n', u'http://www.meituba.com/tag/meitun.html': ' \xe7\xbe\x8e\xe8\x87\x80\n', u'http://www.meituba.com/tag/xingganbaobei.html': ' \xe6\x80\xa7\xe6\x84\x9f\xe5\xae\x9d\xe8\xb4\x9d\n', u'http://www.meituba.com/tag/yuzu.html': ' \xe7\x8e\x89\xe8\xb6\xb3\n', u'http://www.meituba.com/tag/rouganmeinv.html': ' \xe8\x82\x89\xe6\x84\x9f\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/jingyan.html': ' \xe6\x83\x8a\xe8\x89\xb3\n', u'http://www.meituba.com/tag/moguishencai.html': ' \xe9\xad\x94\xe9\xac\xbc\xe8\xba\xab\xe6\x9d\x90\n', u'http://www.meituba.com/tag/qiaotunmeinv.html': ' \xe7\xbf\x98\xe8\x87\x80\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/zhiyezhuang.html': ' \xe8\x81\x8c\xe4\xb8\x9a\xe8\xa3\x85\n', u'http://www.meituba.com/tag/chengshumeinv.html': ' \xe6\x88\x90\xe7\x86\x9f\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/xingganjiaoshi.html': ' \xe6\x80\xa7\xe6\x84\x9f\xe6\x95\x99\xe5\xb8\x88\n', u'http://www.meituba.com/tag/shaofu.html': ' \xe5\xb0\x91\xe5\xa6\x87\n', u'http://www.meituba.com/tag/reku.html': ' \xe7\x83\xad\xe8\xa3\xa4\n', u'http://www.meituba.com/tag/meizu.html': ' \xe7\xbe\x8e\xe8\xb6\xb3\n', u'http://www.meituba.com/tag/yangyanmeinv.html': ' \xe5\x85\xbb\xe7\x9c\xbc\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/leisi.html': ' \xe8\x95\xbe\xe4\xb8\x9d\n', u'http://www.meituba.com/tag/qingxiu.html': ' \xe6\xb8\x85\xe7\xa7\x80\n', u'http://www.meituba.com/tag/kuangye.html': ' \xe7\x8b\x82\xe9\x87\x8e\n', u'http://www.meituba.com/tag/duankumeinv.html': ' \xe7\x9f\xad\xe8\xa3\xa4\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/daxiongmeinv.html': ' \xe5\xa4\xa7\xe8\x83\xb8\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/shishen.html': ' \xe6\xb9\xbf\xe8\xba\xab\n', u'http://www.meituba.com/tag/xinggannvsheng.html': ' \xe6\x80\xa7\xe6\x84\x9f\xe5\xa5\xb3\xe7\x94\x9f\n', u'http://www.meituba.com/tag/00hou.html': ' \xe5\x90\x8e\n', u'http://www.meituba.com/tag/toushizhuang.html': ' \xe9\x80\x8f\xe8\xa7\x86\xe8\xa3\x85\n', u'http://www.meituba.com/tag/kongjie.html': ' \xe7\xa9\xba\xe5\xa7\x90\n', u'http://www.meituba.com/tag/wsmeinv.html': ' \xe7\xba\xb9\xe8\xba\xab\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/tongyan.html': ' \xe7\xab\xa5\xe9\xa2\x9c\n', u'http://www.meituba.com/tag/dayanmeinv.html': ' \xe5\xa4\xa7\xe7\x9c\xbc\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/xingganmeimei.html': ' \xe6\x80\xa7\xe6\x84\x9f\xe7\xbe\x8e\xe7\x9c\x89\n', u'http://www.meituba.com/tag/changtuimeinv.html': ' \xe9\x95\xbf\xe8\x85\xbf\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/shatanmeinv.html': ' \xe6\xb2\x99\xe6\xbb\xa9\xe7\xbe\x8e\xe5\xa5\xb3\n', u'http://www.meituba.com/tag/bainen.html': ' \xe7\x99\xbd\xe5\xab\xa9\n', u'http://www.meituba.com/tag/xingganmishu.html': ' \xe6\x80\xa7\xe6\x84\x9f\xe7\xa7\x98\xe4\xb9\xa6\n', u'http://www.meituba.com/tag/bosha.html': ' \xe8\x96\x84\xe7\xba\xb1\n', u'http://www.meituba.com/tag/hushi.html': ' \xe6\x8a\xa4\xe5\xa3\xab\n', u'http://www.meituba.com/tag/chaomo.html': ' \xe8\xb6\x85\xe6\xa8\xa1\n', u'http://www.meituba.com/tag/nvshen.html': ' \xe5\xa5\xb3\xe7\xa5\x9e\n', u'http://www.meituba.com/tag/shuiyi.html': ' \xe7\x9d\xa1\xe8\xa1\xa3\n', u'http://www.meituba.com/tag/xiangjian.html': ' \xe9\xa6\x99\xe8\x82\xa9\n', u'http://www.meituba.com/tag/qipao.html': ' \xe6\x97\x97\xe8\xa2\x8d\n', u'http://www.meituba.com/tag/chaoduanqun.html': ' \xe8\xb6\x85\xe7\x9f\xad\xe8\xa3\x99\n', u'http://www.meituba.com/tag/youwu.html': ' \xe5\xb0\xa4\xe7\x89\xa9\n'}


def download(down_img,dir, processes=5):
    pool = Pool(processes)
    count = 1
    path = 'img/'
    global old_url
    while True:
        if down_img.isEmpty():
            break
        url_img = down_img.getNewUrl()
        file_ = path+dir+'/'+str(count)+url_img[url_img.rfind('.'):]
        if url_img and url_img not in old_url:
            pool.apply_async(download_info.save_img, (url_img,file_,))
            old_url[url_img]=1
        else:
            break
        count += 1
        if count%300==0:
            print 'down_load imgs :'+str(count)

    json.dump(old_url, open('old_url', 'wb'), indent=2)
    pool.close()
    pool.join()


if __name__ == '__main__':
    # 下载图片描述信息
    defaultencoding = 'utf-8'
    if sys.getdefaultencoding() != defaultencoding:
        reload(sys)
        sys.setdefaultencoding(defaultencoding)
    path = 'img/'
    global old_url

    old_url = json.loads(open('old_url','rb').read())

    for url_ in url:
        print 'now down load class is :',url[url_]
        down_img = download_info.download_info(url_)

        print url_,down_img.url_target.qsize()
        dir = url[url_].strip()
        if not os.path.isdir(path+dir):
            os.mkdir(path+dir)
        else:
            continue
        download(down_img,dir, processes=5)



